<!DOCTYPE html>
<html>
    <head>
        <title>jaburns.net - Vector Caves</title>
        <link rel="stylesheet" type="text/css" href="style.css" />
        <style>
            .canvas-holder {
                text-align: center;
            }
            canvas {
                display: inline-block;
                border: 10px solid #29211c;
                background-color: white;
            }
            input { 
                margin: auto;
                display: block;
                width: 300px;
            }
        </style>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <main class="contents">
            <div class="title">Generating vector caves from cellular automata</div>

            <p>Let's make a little shooter game in a procedurally generated cave. 
            We'll start off by using a 2D cellular automaton to generate a cave shape.
            <a href="https://blog.jrheard.com/procedural-dungeon-generation-cellular-automata" >
            This blog post does a great job of describing the technique.</a> 
            </p>

            <div class="canvas-holder">
                <canvas id="first-canvas" width="300" height="300"></canvas>
            </div>

            <p><input id="seed-slider" type="range" min="0" max="100" step="1" value="50"></p>
            <p><input id="pop-slider" type="hidden" min="0" max="1" step="0.01" value="0.48"></p>
            <p><input id="gen-slider" type="hidden" min="0" max="50" step="1" value="50"></p>

            <p>This technique does a good job of generating dungeon-like shapes, but 
            it often leaves us with inaccessible rooms. Since we don't want the players
            to be able spawn in tiny isolated chambers, let's color all the contiguous
            chambers and fill in all but the largest one with dirt.
            </p>

            <div class="canvas-holder">
                <canvas id="second-canvas" width="300" height="300"></canvas>
                <canvas id="third-canvas" width="300" height="300"></canvas>
            </div>

            <p>
            Now that we can safely throw the player in to any white region, and they will
            be able to navigate to anywhere else on the map, the next step is to turn this
            blocky world in to something smooth. First let's mark off every dirt tile that 
            has air in its von Neumann neighborhood. While we're at it, we can assign each
            of these surface tiles a 2D normal direction by looking at <i>which</i> tiles
            exactly are the ones with air.
            </p>

            <div class="canvas-holder">
                <canvas id="fourth-canvas" width="300" height="300"></canvas>
            </div>

            <p>
            Then we use some heuristic I pulled from my ass to find interesting points along
            the boundary to iterpolate between. It's something like: walk along the boundary
            and if the normal of the point changes, it's important.
            </p>

            <div class="canvas-holder">
                <canvas id="fifth-canvas" width="300" height="300"></canvas>
            </div>
            <p><input id="insurance-slider" type="range" min="0" max="2" step="1" value="1"></p>

            <p>
            Now let's blow this up and draw some lines between the "important" points we found.
            </p>

            <div class="canvas-holder">
                <canvas id="sixth-canvas" width="675" height="675"></canvas>
            </div>

            <p>
            Then we'll use <a href="http://www.antigrain.com/research/bezier_interpolation/">some
            kind of an algorithm or something</a> to make this better. Once we've got our nice smooth
            cave world, let's find the point that's closest to the top left and mark it. We'll make a
            seam from here to a large bounding box around the outside so that we can fill the outer
            ground area.
            </p>

            <div class="canvas-holder">
                <canvas id="seventh-canvas" width="675" height="675"></canvas>
            </div>

            <p>
            Here's another unlabeled slider bound to the parameter of a random function:
            </p>
            <p><input id="curviness-slider" type="range" min="0" max="100" step="1" value="50"></p>

            <p>
            And here's our filled in cave:
            </p>

            <div class="canvas-holder">
                <canvas id="eighth-canvas" width="675" height="675"></canvas>
            </div>


            <br /> <br /> <br /> <br /> <br /> <br />
            <br /> <br /> <br /> <br /> <br /> <br />
            <br /> <br /> <br /> <br /> <br /> <br />
        </main>
    </body>
    <script type="text/javascript" src="bundle.js"></script>
    <script type="text/javascript"> initPost('vector-caves'); </script>
</html>
