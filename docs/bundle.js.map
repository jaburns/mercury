{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/grid.ts","webpack:///./src/main.ts","webpack:///./src/vector-caves.ts","webpack:///./src/automaton.ts","webpack:///./src/prng.ts","webpack:///./src/findContours.ts","webpack:///./src/math.ts","webpack:///./src/smoothCurve.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","WriteGrid","width","height","this","vals","Array","write","x","y","val","at","copyFrom","grid","safeOutOfBounds","oobValue","GridTool","find","test","forEach","fn","map","result","postInitters","vector-caves","initPost","window","grid_1","automaton_1","findContours_1","smoothCurve_1","floodFill","replace","count","tile","events","listener","ctx","document","getElementById","getContext","seedSlider","popSlider","genSlider","ctx2","ctx3","ctx4","ctx5","ctx6","ctx7","update","runCellularAutomaton","parseInt","parseFloat","fillStyle","fillRect","coloredGrid","bigColor","color","largestColor","largestRegion","pos","size","colorGridRegions","gridColorForNumber","filledMap","edgeMarkedMap","markEdges","kind","degs","Math","cos","PI","sin","hx","round","hy","toString","gridColorForNormal","normal","contours","findContours","walkMap","WalkedStatus","WalkedImportant","Walked","strokeStyle","length","j","a","b","beginPath","moveTo","lineTo","stroke","smoothContours","smoothCurve","e","prng_1","getNeighborhood","nx","ny","seed","population","birth","survival","iterations","buffer","rand","nextRandom01","fill","neighbors","M","prevRandom01","floor","math_1","u","spaceInsurance","_","Unwalked","iter","newContour","findOneContour","push","bestCandidate","prev","candidates","minVal","minI","abs","smallestDifferenceRadians","freshStart","findFreshContour","points","lastCan","dx","dy","lastStatus","newStatus","V2","add","plus","minus","sqrt","scaled","input","resolution","curviness","pts","curr","next","lenA","lenB","midA","midB","midDiff","diffA","diffB","pt","controlA","controlB","inc","newVal"],"mappings":"aACA,IAAAA,EAAA,GAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAC,QAGA,IAAAC,EAAAJ,EAAAE,GAAA,CACAG,EAAAH,EACAI,GAAA,EACAH,QAAA,IAUA,OANAI,EAAAL,GAAAM,KAAAJ,EAAAD,QAAAC,IAAAD,QAAAF,GAGAG,EAAAE,GAAA,EAGAF,EAAAD,QAKAF,EAAAQ,EAAAF,EAGAN,EAAAS,EAAAV,EAGAC,EAAAU,EAAA,SAAAR,EAAAS,EAAAC,GACAZ,EAAAa,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,EAAA,CAA0CK,YAAA,EAAAC,IAAAL,KAK1CZ,EAAAkB,EAAA,SAAAhB,GACA,oBAAAiB,eAAAC,aACAN,OAAAC,eAAAb,EAAAiB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAAb,EAAA,cAAiDmB,OAAA,KAQjDrB,EAAAsB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAArB,EAAAqB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFA1B,EAAAkB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAArB,EAAAU,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAzB,EAAA6B,EAAA,SAAA1B,GACA,IAAAS,EAAAT,KAAAqB,WACA,WAA2B,OAAArB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAH,EAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,EAAAa,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD/B,EAAAkC,EAAA,GAIAlC,IAAAmC,EAAA,mFCzEA,IAAAC,EAAA,WAMI,SAAAA,EAAYC,EAAeC,GACvBC,KAAKF,MAAQA,EACbE,KAAKD,OAASA,EACdC,KAAKC,KAAO,IAAIC,MAAMJ,EAAQC,GAkBtC,OAfIF,EAAAJ,UAAAU,MAAA,SAAMC,EAAWC,EAAWC,GACxBN,KAAKC,KAAKG,EAAIC,EAAEL,KAAKF,OAASQ,GAGlCT,EAAAJ,UAAAc,GAAA,SAAGH,EAAWC,GACV,OAAOL,KAAKC,KAAKG,EAAIC,EAAEL,KAAKF,QAGhCD,EAAAJ,UAAAe,SAAA,SAASC,GACL,IAAK,IAAIL,EAAI,EAAGA,EAAIJ,KAAKF,OAASM,EAAIK,EAAKX,QAASM,EAChD,IAAK,IAAIC,EAAI,EAAGA,EAAIL,KAAKD,QAAUM,EAAII,EAAKV,SAAUM,EAClDL,KAAKG,MAAMC,EAAGC,EAAGI,EAAKF,GAAGH,EAAGC,KAI5CR,EA3BA,GAAalC,EAAAkC,YA6BAlC,EAAA+C,gBAAkB,SAAID,EAAeE,GAAyB,OACvEb,MAAOW,EAAKX,MACZC,OAAQU,EAAKV,OACbQ,GAAI,SAACH,EAAGC,GAAM,OAAAD,EAAI,GAAKC,EAAI,GAAKD,GAAKK,EAAKX,OAASO,GAAKI,EAAKX,MAAQa,EAAWF,EAAKF,GAAGH,EAAGC,MAGlF1C,EAAAiD,SAAW,CACpBC,KAAM,SAAIJ,EAAeK,GACrB,IAAK,IAAIV,EAAI,EAAGA,EAAIK,EAAKX,QAASM,EAC9B,IAAK,IAAIC,EAAI,EAAGA,EAAII,EAAKV,SAAUM,EAC/B,GAAIS,EAAKV,EAAGC,EAAGI,EAAKF,GAAGH,EAAGC,IACtB,MAAO,CAAED,EAACA,EAAEC,EAACA,GAIzB,OAAO,MAGXU,QAAS,SAAIN,EAAeO,GACxB,IAAK,IAAIZ,EAAI,EAAGA,EAAIK,EAAKX,QAASM,EAC9B,IAAK,IAAIC,EAAI,EAAGA,EAAII,EAAKV,SAAUM,EAC/BW,EAAGZ,EAAGC,EAAGI,EAAKF,GAAGH,EAAGC,KAKhCY,IAAK,SAAOR,EAAeO,GAGvB,IAFA,IAAME,EAAS,IAAIrB,EAAaY,EAAKX,MAAOW,EAAKV,QAExCK,EAAI,EAAGA,EAAIK,EAAKX,QAASM,EAC9B,IAAK,IAAIC,EAAI,EAAGA,EAAII,EAAKV,SAAUM,EAC/Ba,EAAOf,MAAMC,EAAGC,EAAGW,EAAGZ,EAAGC,EAAGI,EAAKF,GAAGH,EAAGC,KAI/C,OAAOa,mFCzEf,IAEMC,EAA4C,CAC9CC,eAHJ3D,EAAA,GAGoB4D,UAGnBC,OAAeD,SAAW,SAACjD,GACxB,OAAA+C,EAAa/C,qFCPjB,IAAAmD,EAAA9D,EAAA,GACA+D,EAAA/D,EAAA,GACAgE,EAAAhE,EAAA,GACAiE,EAAAjE,EAAA,GAEMkE,EAAY,SAAClB,EAAyBL,EAAWC,EAAWuB,EAAiB9C,EAAe+C,GAC9F,GAAIzB,EAAI,GAAKC,EAAI,EAAG,OAAOwB,EAC3B,GAAIzB,GAAKK,EAAKX,OAASO,GAAKI,EAAKV,OAAQ,OAAO8B,EAEhD,IAAMC,EAAOrB,EAAKF,GAAGH,EAAGC,GAExB,OAAIyB,IAAShD,EAAc+C,EACvBC,IAASF,EAAgBC,GAE7BpB,EAAKN,MAAMC,EAAGC,EAAGvB,GAGjB+C,EAAQF,EAAUlB,EAAML,EAAI,EAAGC,EAAGuB,EAAS9C,IAF3C+C,GAGAA,EAAQF,EAAUlB,EAAML,EAAI,EAAGC,EAAGuB,EAAS9C,EAAO+C,GAClDA,EAAQF,EAAUlB,EAAML,EAAGC,EAAI,EAAGuB,EAAS9C,EAAO+C,GAClDA,EAAQF,EAAUlB,EAAML,EAAGC,EAAI,EAAGuB,EAAS9C,EAAO+C,KAyDzClE,EAAA0D,SAAW,WACpB,IAT4BU,EAAkBC,EAUxCC,EADcC,SAASC,eAAe,gBACpBC,WAAW,MAE7BC,EAAaH,SAASC,eAAe,eACrCG,EAAYJ,SAASC,eAAe,cACpCI,EAAYL,SAASC,eAAe,cAGpCK,EADeN,SAASC,eAAe,iBACnBC,WAAW,MAG/BK,EADcP,SAASC,eAAe,gBACnBC,WAAW,MAG9BM,EADeR,SAASC,eAAe,iBACnBC,WAAW,MAG/BO,EADcT,SAASC,eAAe,gBACnBC,WAAW,MAG9BQ,EADcV,SAASC,eAAe,gBACnBC,WAAW,MAG9BS,EADgBX,SAASC,eAAe,kBACnBC,WAAW,MAEhCU,EAAS,WACX,IAAMrC,EAAOe,EAAAuB,qBACT,GAAI,GACJC,SAASX,EAAWvD,OACpBmE,WAAWX,EAAUxD,OACrB,EAAG,EACHkE,SAAST,EAAUzD,QAGvByC,EAAAX,SAASG,QAAQN,EAAM,SAACL,EAAGC,EAAGC,GAC1B2B,EAAIiB,UAAY5C,EAAM,OAAS,OAC/B2B,EAAIkB,SAAS,EAAE/C,EAAG,EAAEC,EAAG,EAAG,KAG9B,IAAM+C,EAAc7B,EAAAX,SAASK,IAAIR,EAAM,SAACL,EAAGC,EAAGC,GAAQ,OAAAA,GAAO,EAAI,IAC3D+C,EA9FW,SAAC5C,GAKtB,IAJA,IAAI6C,EAAQ,EACRC,GAAgB,EAChBC,EAAgB,IAEP,CACT,IAAMC,EAAMlC,EAAAX,SAASC,KAAKJ,EAAM,SAACL,EAAGC,EAAGC,GAAQ,OAAQ,IAARA,IAC/C,GAAY,OAARmD,EAAc,OAAOF,EAEzB,IAAMG,EAAO/B,EAAUlB,EAAMgD,EAAIrD,EAAGqD,EAAIpD,EAAG,EAAGiD,EAAO,GAEjDI,EAAOF,IACPA,EAAgBE,EAChBH,EAAeD,GAGnBA,KA8EiBK,CAAiBP,GAElC7B,EAAAX,SAASG,QAAQqC,EAAa,SAAChD,EAAGC,EAAGC,GACjCkC,EAAKU,UA7EU,SAAC5D,GACxB,GAAIA,EAAI,EAAG,MAAO,OAClB,OAAQA,EAAI,GACR,KAAM,EAAG,MAAO,OAChB,KAAM,EAAG,MAAO,OAChB,KAAM,EAAG,MAAO,OAChB,KAAM,EAAG,MAAO,OAChB,KAAM,EAAG,MAAO,OAChB,KAAM,EAAG,MAAO,OAEpB,MAAO,GAmEkBsE,CAAmBtD,GACpCkC,EAAKW,SAAS,EAAE/C,EAAG,EAAEC,EAAG,EAAG,KAG/B,IAAMwD,EAAYtC,EAAAX,SAASK,IAAImC,EAAa,SAAChD,EAAGC,EAAGC,GAAQ,OAAAA,IAAQ+C,IAEnE9B,EAAAX,SAASG,QAAQ8C,EAAW,SAACzD,EAAGC,EAAGC,GAC/BmC,EAAKS,UAAY5C,EAAM,OAAS,OAChCmC,EAAKU,SAAS,EAAE/C,EAAG,EAAEC,EAAG,EAAG,KAG/B,IAAMyD,EAAgBrC,EAAAsC,UAAUF,GAEhCtC,EAAAX,SAASG,QAAQ+C,EAAe,SAAC1D,EAAGC,EAAGC,GACnCoC,EAAKQ,UAAyB,SAAb5C,EAAI0D,KA9EN,SAACC,GACxB,IAAM7D,EAAI8D,KAAKC,IAAIF,EAAOC,KAAKE,GAAK,KAC9B/D,EAAI6D,KAAKG,IAAIJ,EAAOC,KAAKE,GAAK,KAE9BE,EAAKJ,KAAKK,MAAM,IAAM,GAAInE,EAAI,KAC9BoE,EAAKN,KAAKK,MAAM,IAAM,GAAIlE,EAAI,KAIpC,MAFe,IAAMiE,EAAGG,SAAS,IAAMD,EAAGC,SAAS,IAAM,IAuEVC,CAAmBpE,EAAIqE,QAAuB,QAAbrE,EAAI0D,KAAiB,OAAS,OACtGtB,EAAKS,SAAS,EAAE/C,EAAG,EAAEC,EAAG,EAAG,KAG/B,IAAMuE,EAAWnD,EAAAoD,aAAaf,EAAe,GAE7CvC,EAAAX,SAASG,QAAQ6D,EAASE,QAAS,SAAC1E,EAAGC,EAAGC,GACtCqC,EAAKO,UAAY5C,IAAQmB,EAAAsD,aAAaC,gBAAkB,OAAS1E,IAAQmB,EAAAsD,aAAaE,OAAS,OAAS,OACxGtC,EAAKQ,SAAS,EAAE/C,EAAG,EAAEC,EAAG,EAAG,GAE3BuC,EAAKM,UAAY5C,IAAQmB,EAAAsD,aAAaC,gBAAkB,OAAS,OACjEpC,EAAKO,SAAS,EAAE/C,EAAG,EAAEC,EAAG,EAAG,KAG/BuC,EAAKsC,YAAc,OAEnBN,EAASA,SAAS7D,QAAQ,SAAA7C,GACtB,IAAK,IAAIL,EAAI,EAAGA,EAAIK,EAAEiH,SAAUtH,EAAG,CAC/B,IAAMuH,GAAKvH,EAAI,GAAKK,EAAEiH,OAChBE,EAAI,CAAEjF,EAAG,EAAIwE,EAASE,QAAQhF,MAAQ5B,EAAEL,GAAGuC,EAAGC,EAAG,EAAIuE,EAASE,QAAQ/E,OAAS7B,EAAEL,GAAGwC,GACpFiF,EAAI,CAAElF,EAAG,EAAIwE,EAASE,QAAQhF,MAAQ5B,EAAEkH,GAAGhF,EAAGC,EAAG,EAAIuE,EAASE,QAAQ/E,OAAS7B,EAAEkH,GAAG/E,GAE1FuC,EAAK2C,YACL3C,EAAK4C,OAAO,EAAIZ,EAASE,QAAQhF,MAAQ,EAAIuF,EAAEjF,EAAG,EAAIwE,EAASE,QAAQ/E,OAAS,EAAIsF,EAAEhF,GACtFuC,EAAK6C,OAAO,EAAIb,EAASE,QAAQhF,MAAQ,EAAIwF,EAAElF,EAAG,EAAIwE,EAASE,QAAQ/E,OAAS,EAAIuF,EAAEjF,GACtFuC,EAAK8C,YAIb,IAAMC,EAAiBf,EAASA,SAAS3D,IAAI,SAAAb,GAAK,OAAAsB,EAAAkE,YAAYxF,EAAG,GAAI,KAErEyC,EAAKqC,YAAc,OACnBrC,EAAKK,UAAY,OACjBL,EAAKM,SAAS,EAAG,EAAG,IAAK,KAEzBwC,EAAe5E,QAAQ,SAAA7C,GACnB,IAAK,IAAIL,EAAI,EAAGA,EAAIK,EAAEiH,SAAUtH,EAAG,CAC/B,IAAMuH,GAAKvH,EAAI,GAAKK,EAAEiH,OAChBE,EAAI,CAAEjF,EAAG,EAAIwE,EAASE,QAAQhF,MAAQ5B,EAAEL,GAAGuC,EAAGC,EAAG,EAAIuE,EAASE,QAAQ/E,OAAS7B,EAAEL,GAAGwC,GACpFiF,EAAI,CAAElF,EAAG,EAAIwE,EAASE,QAAQhF,MAAQ5B,EAAEkH,GAAGhF,EAAGC,EAAG,EAAIuE,EAASE,QAAQ/E,OAAS7B,EAAEkH,GAAG/E,GAE1FwC,EAAK0C,YACL1C,EAAK2C,OAAO,EAAIZ,EAASE,QAAQhF,MAAQ,EAAIuF,EAAEjF,EAAG,EAAIwE,EAASE,QAAQ/E,OAAS,EAAIsF,EAAEhF,GACtFwC,EAAK4C,OAAO,EAAIb,EAASE,QAAQhF,MAAQ,EAAIwF,EAAElF,EAAG,EAAIwE,EAASE,QAAQ/E,OAAS,EAAIuF,EAAEjF,GACtFwC,EAAK6C,aA9GW3D,EAqHxB,CAAC,UAAW,YArH8BC,EAsH1Cc,EAFA,CAACR,EAAWC,EAAWF,GAnHtBtB,QAAQ,SAAAzC,GACTyD,EAAOhB,QAAQ,SAAA8E,GACXvH,EAAEuH,GAAK7D,MAqHfc,oFC7LJ,IAAAgD,EAAArI,EAAA,GACA8D,EAAA9D,EAAA,GAEMsI,EAAkB,SAAC9E,EAAoBb,EAAWC,GAGpD,IAFA,IAAIa,EAAiB,EAEZ8E,EAAK5F,EAAE,EAAG4F,GAAM5F,EAAE,IAAK4F,EAC5B,IAAK,IAAIC,EAAK5F,EAAE,EAAG4F,GAAM5F,EAAE,IAAK4F,EACxBD,GAAM5F,GAAK6F,GAAM5F,IACjB2F,EAAK,GAAKC,EAAK,GAAKD,GAAM/E,EAAInB,MAAM,GAAKmG,GAAMhF,EAAIlB,OAAO,EAAGmB,IAC5DA,GAAUD,EAAIV,GAAGyF,EAAGC,GAAM,EAAI,GAI3C,OAAO/E,GAGEvD,EAAAoF,qBAAuB,SAACjD,EAAeC,EAAgBmG,EAAcC,EAAoBC,EAAeC,EAAkBC,GAKnI,IAJA,IAAMpF,EAAS,IAAIK,EAAA1B,UAAmBC,EAAOC,GACvCwG,EAAS,IAAIhF,EAAA1B,UAAmBC,EAAOC,GACzCyG,EAAOV,EAAAW,aAAaP,EAAO,KAEtB9F,EAAI,EAAGA,EAAIN,IAASM,EACzB,IAAK,IAAIC,EAAI,EAAGA,EAAIN,IAAUM,EAAG,CAC7B,IAAMqG,EAAa,IAANtG,GAAiB,IAANC,GAAWD,IAAMN,EAAM,GAAKO,IAAMN,EAAO,GAAKyG,EAAOL,EAC7EjF,EAAOf,MAAMC,EAAGC,EAAGqG,GACnBH,EAAOpG,MAAMC,EAAGC,EAAGqG,GAEnBF,EAAOV,EAAAW,aAAaD,GAI5B,IAAK,IAAI3I,EAAI,EAAGA,EAAIyI,IAAczI,EAAG,CACjC,IAASuC,EAAI,EAAGA,EAAIN,EAAM,IAAKM,EAC3B,IAASC,EAAI,EAAGA,EAAIN,EAAO,IAAKM,EAAG,CAC/B,IAAMsG,EAAYZ,EAAgB7E,EAAQd,EAAGC,GAC7CkG,EAAOpG,MAAMC,EAAGC,EAAGsG,IAAczF,EAAOX,GAAGH,EAAGC,GAAKgG,EAAWD,IAGtElF,EAAOV,SAAS+F,GAGpB,OAAOrF,kFCxCX,IAAM0F,EAAI,WAIGjJ,EAAA8I,aAAe,SAACI,GACzB,OAJM,QAIA3C,KAAK4C,MAAMD,EAAeD,GAH1B,YAGoCA,EAAKA,kFCPnD,IAuCY7B,EAvCZxD,EAAA9D,EAAA,GACAsJ,EAAAtJ,EAAA,GAOaE,EAAAoG,UAAY,SAACtD,GAItB,IAHA,IAAMS,EAASK,EAAAX,SAASK,IAAIR,EAAM,SAACL,EAAGC,EAAGC,GACrC,OAAG0D,KAAM1D,EAAM,OAAS,MAAOqE,OAAQ,KAElCvE,EAAI,EAAGA,EAAIK,EAAKX,MAAOM,IAC5B,IAAK,IAAIC,EAAI,EAAGA,EAAII,EAAKV,OAAQM,IAC7B,GAAKI,EAAKF,GAAGH,EAAGC,GAAhB,CAEA,IAAMvC,EAAIsC,EAAI,IAAoBK,EAAKF,GAAGH,EAAE,EAAGC,GACzC1B,EAAIyB,EAAIK,EAAKX,MAAQ,IAAOW,EAAKF,GAAGH,EAAE,EAAGC,GACzC2G,EAAI3G,EAAI,IAAoBI,EAAKF,GAAGH,EAAGC,EAAE,GACzClC,EAAIkC,EAAII,EAAKV,OAAS,IAAMU,EAAKF,GAAGH,EAAGC,EAAE,GAE/C,GAAKvC,GAAMa,GAAMqI,GAAM7I,EAAvB,CAEA,IAAMwG,EAAShG,GAAKR,EAAI,GACpBA,GAAKL,EAAK,IACVA,GAAKkJ,GAAK,IACVA,GAAKrI,GAAM,GACXA,EAAI,EACJR,EAAI,GACJL,EAAI,KACH,GAELoD,EAAOf,MAAMC,EAAGC,EAAG,CAAE2D,KAAM,OAAQW,OAAMA,KAIjD,OAAOzD,GAGX,SAAY6D,GACRA,IAAA,uBACAA,IAAA,mBACAA,IAAA,qCAHJ,CAAYA,EAAApH,EAAAoH,eAAApH,EAAAoH,aAAY,KAsBXpH,EAAAkH,aAAe,SAACpE,EAA+BwG,GACxD,IACMnC,EAAUvD,EAAAX,SAASK,IAAI,IAAIM,EAAA1B,UAAwBY,EAAKX,MAAOW,EAAKV,QAAS,SAAAmH,GAAK,OAAAnC,EAAaoC,WAC/FvC,EAAqB,GAEvBwC,EAAO,EACPC,EAA4B,KAEhC,GAEuB,QADnBA,EAAaC,EAAexC,EAASrE,EAAMwG,KAChBI,EAAWlC,OAAS,GAC3CP,EAAS2C,KAAKF,SAEC,MAAdA,GAAsBD,IAZd,KAcjB,MAAO,CAAExC,SAAQA,EAAEE,QAAOA,IAI9B,IAYM0C,EAAgB,SAACC,EAAqBC,GAIxC,IAHA,IAAIC,EAAS,IACTC,EAAO,EAEF/J,EAAI,EAAGA,EAAI6J,EAAWvC,SAAUtH,EAAG,CACxC,IAAMK,EAAIwJ,EAAW7J,GACfM,EAAI+F,KAAK2D,IAAId,EAAAe,0BACf5J,EAAEyG,OAAST,KAAKE,GAAK,IACrBqD,EAAK9C,OAAST,KAAKE,GAAK,MAGxBjG,EAAIwJ,IACJA,EAASxJ,EACTyJ,EAAO/J,GAIf,OAAO6J,EAAWE,IAGhBN,EAAiB,SAACxC,EAAkCrE,EAA+BwG,GACrF,IAEMc,EAnCe,SAACjD,EAA6BrE,GACnD,IAAK,IAAIL,EAAI,EAAGA,EAAIK,EAAKX,MAAOM,IAC5B,IAAK,IAAIC,EAAI,EAAGA,EAAII,EAAKV,OAAQM,IAC7B,GAA2B,SAAvBI,EAAKF,GAAGH,EAAGC,GAAG2D,MAAmBc,EAAQvE,GAAGH,EAAGC,KAAO0E,EAAaoC,SACnE,MAAO,CAAE/G,EAACA,EAAEC,EAACA,GAKzB,OAAO,KA0BY2H,CAAiBlD,EAASrE,GAC7C,GAAmB,OAAfsH,EACA,OAAO,KAGXtH,EAAOc,EAAAb,gBAAgBD,EAAM,CAACuD,KAAM,OAAQW,OAAQ,IAEpD,IAAMsD,EAAiB,GACnB7H,EAAI2H,EAAW3H,EACfC,EAAI0H,EAAW1H,EAEf+G,EAAO,EACPc,EAAyB,CAAEC,GAAI,EAAGC,GAAI,EAAGzD,OAAQ,GACjD0D,EAAatD,EAAaE,OAC1ByC,EAA8B,GAElC,EAAG,CACCA,EAAa,GAEb,IAAK,IAAIS,GAAM,EAAGA,GAAM,EAAGA,IACvB,IAAK,IAAIC,GAAM,EAAGA,GAAM,EAAGA,IACZ,IAAPD,GAAmB,IAAPC,GACiB,SAA7B3H,EAAKF,GAAGH,EAAE+H,EAAI9H,EAAE+H,GAAIpE,MACrBc,EAAQvE,GAAGH,EAAE+H,EAAI9H,EAAE+H,KAAQrD,EAAaoC,UACvCO,EAAWH,KAAK,CAACY,GAAEA,EAAEC,GAAEA,EAAEzD,OAAQlE,EAAKF,GAAGH,EAAE+H,EAAI9H,EAAE+H,GAAIzD,SAKjE,GAAI+C,EAAWvC,OAAS,EAAG,CACvB,IAAMjH,EAAIsJ,EAAcU,EAASR,GACjCtH,GAAKlC,EAAEiK,GACP9H,GAAKnC,EAAEkK,GAEP,IAAIE,EAAYvD,EAAaE,OAC7B,GAAI/G,EAAEyG,SAAWuD,EAAQvD,OAAQ,EAEN,IAAnBsC,IAE0B,IAAnBA,GACa,GAAR/I,EAAEiK,IAAmB,GAARjK,EAAEkK,IAEfC,GAActD,EAAaC,oBAIvCsD,EAAYvD,EAAaC,iBAI7BsD,IAAcvD,EAAaC,iBAC3BiD,EAAOV,KAAK,CACRnH,GAAIA,EAAI,IAAKK,EAAKX,MAAQ,GAC1BO,GAAIA,EAAI,IAAKI,EAAKV,OAAS,KAInC+E,EAAQ3E,MAAMC,EAAGC,EAAGiI,GACpBD,EAAaC,EACbJ,EAAUhK,SAGXwJ,EAAWvC,OAAS,GAAKiC,IAhEf,KAkEjB,OAAOa,kFC9KEtK,EAAA4K,GAAK,CACdC,IAAK,SAACnD,EAASC,GACXD,EAAEjF,GAAKkF,EAAElF,EACTiF,EAAEhF,GAAKiF,EAAEjF,GAGboI,KAAM,SAACpD,EAASC,GAAkB,OAC9BlF,EAAGiF,EAAEjF,EAAIkF,EAAElF,EACXC,EAAGgF,EAAEhF,EAAIiF,EAAEjF,IAGfqI,MAAO,SAACrD,EAASC,GAAkB,OAC/BlF,EAAGiF,EAAEjF,EAAIkF,EAAElF,EACXC,EAAGgF,EAAEhF,EAAIiF,EAAEjF,IAGf8E,OAAQ,SAACE,GACL,OAAAnB,KAAKyE,KAAKtD,EAAEjF,EAAEiF,EAAEjF,EAAIiF,EAAEhF,EAAEgF,EAAEhF,IAE9BuI,OAAQ,SAACvD,EAASzF,GAAoB,OAClCQ,EAAGR,EAAIyF,EAAEjF,EACTC,EAAGT,EAAIyF,EAAEhF,KAIJ1C,EAAAmK,0BAA4B,SAACzC,EAAWC,GASjD,OARAD,GAAK,EAAInB,KAAKE,GACdkB,GAAK,EAAIpB,KAAKE,GAEVF,KAAK2D,IAAIxC,EAAIC,GAAKpB,KAAKE,KACnBiB,EAAI,EAAGA,GAAK,EAAInB,KAAKE,GACpBiB,GAAK,EAAInB,KAAKE,IAGhBiB,EAAIC,kFCvCf,IAAAyB,EAAAtJ,EAAA,GAQaE,EAAAiI,YAAc,SAACiD,EAAeC,EAAoBC,GAC3D,IAAMC,EAAY,GAEdF,EAAa,IAAGA,EAAa,GAEjC,IAAK,IAAIjL,EAAI,EAAGA,EAAIgL,EAAM1D,SAAUtH,EAAG,CACnC,IAAM4J,EAAOoB,EAAW,GAALhL,EAASgL,EAAM1D,OAAO,EAAItH,EAAE,GACzCoL,EAAOJ,EAAMhL,GACbqL,EAAOL,GAAOhL,EAAI,GAAKgL,EAAM1D,QAE7BgE,EAAOpC,EAAAwB,GAAGpD,OAAO4B,EAAAwB,GAAGG,MAAMjB,EAAMwB,IAChCG,EAAOrC,EAAAwB,GAAGpD,OAAO4B,EAAAwB,GAAGG,MAAMO,EAAMC,IAEhCG,EAAOtC,EAAAwB,GAAGK,OAAO7B,EAAAwB,GAAGE,KAAKhB,EAAMwB,GAAO,IACtCK,EAAOvC,EAAAwB,GAAGK,OAAO7B,EAAAwB,GAAGE,KAAKQ,EAAMC,GAAO,IACtCK,EAAUxC,EAAAwB,GAAGK,OAAO7B,EAAAwB,GAAGG,MAAMW,EAAMC,GAAOP,GAE1CS,EAAQzC,EAAAwB,GAAGK,OAAOW,EAAUJ,GAAQA,EAAOC,IAC3CK,EAAQ1C,EAAAwB,GAAGK,OAAOW,GAAUH,GAAQD,EAAOC,IAEjDJ,EAAIzB,KAAK,CACLmC,GAAIT,EACJU,SAAU5C,EAAAwB,GAAGE,KAAKQ,EAAMO,GACxBI,SAAU7C,EAAAwB,GAAGE,KAAKQ,EAAMQ,KAIhC,IAAMI,EAAM,EAAIf,EAEV5H,EAAiB,GACvB,IAASrD,EAAI,EAAGA,EAAImL,EAAI7D,SAAUtH,EAC9B,CAAMoL,EAAOD,EAAInL,GACXqL,EAAOF,GAAKnL,EAAI,GAAKmL,EAAI7D,QAE/B,IAHA,IAGSpG,EAAI,EAAGA,EAAI,EAAGA,GAAK8K,EAAK,CAC7B,IAAIC,EAAe,CAAE1J,EAAG,EAAGC,EAAG,GAE9B0G,EAAAwB,GAAGC,IAAIsB,EAAQ/C,EAAAwB,GAAGK,OAAOK,EAAKS,IAAY,EAAE3K,IAAI,EAAEA,IAAI,EAAEA,KACxDgI,EAAAwB,GAAGC,IAAIsB,EAAQ/C,EAAAwB,GAAGK,OAAOK,EAAKW,SAAW,GAAG,EAAE7K,IAAI,EAAEA,GAAGA,IACvDgI,EAAAwB,GAAGC,IAAIsB,EAAQ/C,EAAAwB,GAAGK,OAAOM,EAAKS,SAAW,GAAG,EAAE5K,GAAGA,EAAEA,IACnDgI,EAAAwB,GAAGC,IAAIsB,EAAQ/C,EAAAwB,GAAGK,OAAOM,EAAKQ,GAAW3K,EAAEA,EAAEA,IAE7CmC,EAAOqG,KAAKuC,IAIpB,OAAO5I","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","export interface Grid<T> {\r\n    readonly width: number;\r\n    readonly height: number;\r\n    at(x: number, y: number): T;\r\n}\r\n\r\nexport type GridCallback<T> = (x: number, y: number, val: T) => void;\r\nexport type GridMapper<T,U> = (x: number, y: number, val: T) => U;\r\n\r\nexport class WriteGrid<T> implements Grid<T> {\r\n    public readonly width: number;\r\n    public readonly height: number;\r\n\r\n    private vals: T[];\r\n\r\n    constructor(width: number, height: number) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.vals = new Array(width * height);\r\n    }\r\n\r\n    write(x: number, y: number, val: T): void {\r\n        this.vals[x + y*this.width] = val;\r\n    }\r\n\r\n    at(x: number, y: number): T {\r\n        return this.vals[x + y*this.width];\r\n    }\r\n\r\n    copyFrom(grid: Grid<T>): void {\r\n        for (let x = 0; x < this.width && x < grid.width; ++x) {\r\n            for (let y = 0; y < this.height && y < grid.height; ++y) {\r\n                this.write(x, y, grid.at(x, y));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport const safeOutOfBounds = <T>(grid: Grid<T>, oobValue: T): Grid<T> => ({\r\n    width: grid.width,\r\n    height: grid.height,\r\n    at: (x, y) => x < 0 || y < 0 || x >= grid.width || y >= grid.width ? oobValue : grid.at(x, y)\r\n});\r\n\r\nexport const GridTool = {\r\n    find: <T>(grid: Grid<T>, test: GridMapper<T, boolean>): { x: number, y: number } | null => {\r\n        for (let x = 0; x < grid.width; ++x) {\r\n            for (let y = 0; y < grid.height; ++y) {\r\n                if (test(x, y, grid.at(x, y))) {\r\n                    return { x, y };\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n\r\n    forEach: <T>(grid: Grid<T>, fn: GridCallback<T>): void => {\r\n        for (let x = 0; x < grid.width; ++x) {\r\n            for (let y = 0; y < grid.height; ++y) {\r\n                fn(x, y, grid.at(x, y));\r\n            }\r\n        }\r\n    },\r\n\r\n    map: <T, U>(grid: Grid<T>, fn: GridMapper<T, U>): WriteGrid<U> => {\r\n        const result = new WriteGrid<U>(grid.width, grid.height);\r\n\r\n        for (let x = 0; x < grid.width; ++x) {\r\n            for (let y = 0; y < grid.height; ++y) {\r\n                result.write(x, y, fn(x, y, grid.at(x, y)));\r\n            }\r\n        }\r\n\r\n        return result;\r\n    },\r\n};","import { initPost as initPost_vectorCaves } from './vector-caves';\r\n\r\nconst postInitters: {[key: string]: () => void} = {\r\n    'vector-caves': initPost_vectorCaves\r\n};\r\n\r\n(window as any).initPost = (name: string): void =>\r\n    postInitters[name]();","import { WriteGrid, GridTool } from './grid';\r\nimport { runCellularAutomaton } from './automaton';\r\nimport { markEdges, findContours, WalkedStatus } from './findContours';\r\nimport { smoothCurve } from './smoothCurve';\r\n\r\nconst floodFill = (grid: WriteGrid<number>, x: number, y: number, replace: number, value: number, count: number): number => {\r\n    if (x < 0 || y < 0) return count;\r\n    if (x >= grid.width || y >= grid.height) return count;\r\n\r\n    const tile = grid.at(x, y);\r\n\r\n    if (tile === value) return count;\r\n    if (tile !== replace) return count;\r\n\r\n    grid.write(x, y, value);\r\n    count++;\r\n\r\n    count = floodFill(grid, x - 1, y, replace, value, count);\r\n    count = floodFill(grid, x + 1, y, replace, value, count);\r\n    count = floodFill(grid, x, y - 1, replace, value, count);\r\n    count = floodFill(grid, x, y + 1, replace, value, count);\r\n    return count;\r\n};\r\n\r\nconst colorGridRegions = (grid: WriteGrid<number>): number => {\r\n    let color = 1;\r\n    let largestColor = -1;\r\n    let largestRegion = 0;\r\n\r\n    while (true) {\r\n        const pos = GridTool.find(grid, (x, y, val) => val === 0);\r\n        if (pos === null) return largestColor;\r\n\r\n        const size = floodFill(grid, pos.x, pos.y, 0, color, 0);\r\n\r\n        if (size > largestRegion) {\r\n            largestRegion = size;\r\n            largestColor = color;\r\n        }\r\n\r\n        color++;\r\n    }\r\n};\r\n\r\nconst gridColorForNumber = (n: number): string => {\r\n    if (n < 0) return '#000';\r\n    switch (n % 6) {\r\n        case  0: return '#F00';\r\n        case  1: return '#0F0';\r\n        case  2: return '#00F';\r\n        case  3: return '#0FF';\r\n        case  4: return '#F0F';\r\n        case  5: return '#FF0';\r\n    }\r\n    return '';\r\n};\r\n\r\nconst gridColorForNormal = (degs: number): string => {\r\n    const x = Math.cos(degs * Math.PI / 180);\r\n    const y = Math.sin(degs * Math.PI / 180);\r\n\r\n    const hx = Math.round(15 * (0.5*x + 0.5));\r\n    const hy = Math.round(15 * (0.5*y + 0.5));\r\n\r\n    const result = '#' + hx.toString(16) + hy.toString(16) + 'f';\r\n\r\n    return result;\r\n};\r\n\r\nconst multibind = (objs: any[], events: string[], listener: Function): void => {\r\n    objs.forEach(o => {\r\n        events.forEach(e => {\r\n            o[e] = listener;\r\n        });\r\n    });\r\n};\r\n\r\nexport const initPost = () :void => {\r\n    const firstCanvas = document.getElementById('first-canvas') as HTMLCanvasElement;\r\n    const ctx = firstCanvas.getContext('2d') as CanvasRenderingContext2D;\r\n\r\n    const seedSlider = document.getElementById('seed-slider') as HTMLInputElement;\r\n    const popSlider = document.getElementById('pop-slider') as HTMLInputElement;\r\n    const genSlider = document.getElementById('gen-slider') as HTMLInputElement;\r\n\r\n    const secondCanvas = document.getElementById('second-canvas') as HTMLCanvasElement;\r\n    const ctx2 = secondCanvas.getContext('2d') as CanvasRenderingContext2D;\r\n\r\n    const thirdCanvas = document.getElementById('third-canvas') as HTMLCanvasElement;\r\n    const ctx3 = thirdCanvas.getContext('2d') as CanvasRenderingContext2D;\r\n\r\n    const fourthCanvas = document.getElementById('fourth-canvas') as HTMLCanvasElement;\r\n    const ctx4 = fourthCanvas.getContext('2d') as CanvasRenderingContext2D;\r\n\r\n    const fifthCanvas = document.getElementById('fifth-canvas') as HTMLCanvasElement;\r\n    const ctx5 = fifthCanvas.getContext('2d') as CanvasRenderingContext2D;\r\n\r\n    const sixthCanvas = document.getElementById('sixth-canvas') as HTMLCanvasElement;\r\n    const ctx6 = sixthCanvas.getContext('2d') as CanvasRenderingContext2D;\r\n\r\n    const seventhCanvas = document.getElementById('seventh-canvas') as HTMLCanvasElement;\r\n    const ctx7 = seventhCanvas.getContext('2d') as CanvasRenderingContext2D;\r\n\r\n    const update = () :void => {\r\n        const grid = runCellularAutomaton(\r\n            75, 75,\r\n            parseInt(seedSlider.value),\r\n            parseFloat(popSlider.value),\r\n            5, 4,\r\n            parseInt(genSlider.value)\r\n        );\r\n\r\n        GridTool.forEach(grid, (x, y, val) => {\r\n            ctx.fillStyle = val ? '#000' : '#FFF';\r\n            ctx.fillRect(4*x, 4*y, 4, 4);\r\n        });\r\n\r\n        const coloredGrid = GridTool.map(grid, (x, y, val) => val ? -1 : 0);\r\n        const bigColor = colorGridRegions(coloredGrid);\r\n\r\n        GridTool.forEach(coloredGrid, (x, y, val) => {\r\n            ctx2.fillStyle = gridColorForNumber(val);\r\n            ctx2.fillRect(4*x, 4*y, 4, 4);\r\n        });\r\n\r\n        const filledMap = GridTool.map(coloredGrid, (x, y, val) => val !== bigColor);\r\n\r\n        GridTool.forEach(filledMap, (x, y, val) => {\r\n            ctx3.fillStyle = val ? '#000' : '#FFF';\r\n            ctx3.fillRect(4*x, 4*y, 4, 4);\r\n        });\r\n\r\n        const edgeMarkedMap = markEdges(filledMap);\r\n\r\n        GridTool.forEach(edgeMarkedMap, (x, y, val) => {\r\n            ctx4.fillStyle = val.kind === 'edge' ? gridColorForNormal(val.normal) : val.kind === 'air' ? '#655' : '#77f';\r\n            ctx4.fillRect(4*x, 4*y, 4, 4);\r\n        });\r\n\r\n        const contours = findContours(edgeMarkedMap, 1);\r\n\r\n        GridTool.forEach(contours.walkMap, (x, y, val) => {\r\n            ctx5.fillStyle = val === WalkedStatus.WalkedImportant ? '#fff' : val === WalkedStatus.Walked ? '#333' : '#000';\r\n            ctx5.fillRect(4*x, 4*y, 4, 4);\r\n\r\n            ctx6.fillStyle = val === WalkedStatus.WalkedImportant ? '#333' : '#000';\r\n            ctx6.fillRect(9*x, 9*y, 9, 9);\r\n        });\r\n\r\n        ctx6.strokeStyle = '#f00';\r\n\r\n        contours.contours.forEach(c => {\r\n            for (let i = 0; i < c.length; ++i) {\r\n                const j = (i + 1) % c.length;\r\n                const a = { x: 9 * contours.walkMap.width * c[i].x, y: 9 * contours.walkMap.height * c[i].y };\r\n                const b = { x: 9 * contours.walkMap.width * c[j].x, y: 9 * contours.walkMap.height * c[j].y };\r\n                \r\n                ctx6.beginPath();\r\n                ctx6.moveTo(9 * contours.walkMap.width / 2 + a.x, 9 * contours.walkMap.height / 2 + a.y);\r\n                ctx6.lineTo(9 * contours.walkMap.width / 2 + b.x, 9 * contours.walkMap.height / 2 + b.y);\r\n                ctx6.stroke();\r\n            }\r\n        });\r\n\r\n        const smoothContours = contours.contours.map(x => smoothCurve(x, 10, 1));\r\n\r\n        ctx7.strokeStyle = '#0f0';\r\n        ctx7.fillStyle = '#000';\r\n        ctx7.fillRect(0, 0, 675, 675);\r\n\r\n        smoothContours.forEach(c => {\r\n            for (let i = 0; i < c.length; ++i) {\r\n                const j = (i + 1) % c.length;\r\n                const a = { x: 9 * contours.walkMap.width * c[i].x, y: 9 * contours.walkMap.height * c[i].y };\r\n                const b = { x: 9 * contours.walkMap.width * c[j].x, y: 9 * contours.walkMap.height * c[j].y };\r\n                \r\n                ctx7.beginPath();\r\n                ctx7.moveTo(9 * contours.walkMap.width / 2 + a.x, 9 * contours.walkMap.height / 2 + a.y);\r\n                ctx7.lineTo(9 * contours.walkMap.width / 2 + b.x, 9 * contours.walkMap.height / 2 + b.y);\r\n                ctx7.stroke();\r\n            }\r\n        });\r\n    };\r\n\r\n    multibind(\r\n        [popSlider, genSlider, seedSlider],\r\n        ['oninput', 'onchange'],\r\n        update\r\n    );\r\n    update();\r\n};","import { nextRandom01 } from './prng';\r\nimport { WriteGrid, Grid } from './grid';\r\n\r\nconst getNeighborhood = (map: Grid<boolean>, x: number, y: number): number => {\r\n    let result: number = 0;\r\n\r\n    for (let nx = x-1; nx <= x+1; ++nx) {\r\n        for (let ny = y-1; ny <= y+1; ++ny) {\r\n            if (nx == x && ny == y) continue;\r\n            if (nx < 1 || ny < 1 || nx >= map.width-1 || ny >= map.height-1) result++;\r\n            else result += map.at(nx,ny) ? 1 : 0;\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nexport const runCellularAutomaton = (width: number, height: number, seed: number, population: number, birth: number, survival: number, iterations: number): Grid<boolean> => {\r\n    const result = new WriteGrid<boolean>(width, height);\r\n    const buffer = new WriteGrid<boolean>(width, height);\r\n    let rand = nextRandom01(seed / 101);\r\n\r\n    for (let x = 0; x < width; ++x) {\r\n        for (let y = 0; y < height; ++y) {\r\n            const fill = x === 0 || y === 0 || x === width-1 || y === height-1 || rand < population;\r\n            result.write(x, y, fill);\r\n            buffer.write(x, y, fill);\r\n\r\n            rand = nextRandom01(rand);\r\n        }\r\n    }\r\n\r\n    for (let i = 0; i < iterations; ++i) {\r\n        for (let x = 1; x < width-1; ++x) {\r\n            for (let y = 1; y < height-1; ++y) {\r\n                const neighbors = getNeighborhood(result, x, y);\r\n                buffer.write(x, y, neighbors >= (result.at(x, y) ? survival : birth));\r\n            }\r\n        }\r\n        result.copyFrom(buffer);\r\n    }\r\n\r\n    return result;\r\n}","// https://en.wikipedia.org/wiki/Linear_congruential_generator\r\n\r\nconst M = 4294967296;\r\nconst A = 1664525;\r\nconst C = 1013904223;\r\n\r\nexport const nextRandom01 = (prevRandom01: number): number => \r\n    ((A * Math.floor(prevRandom01 * M) + C) % M) / M;","import { Grid, WriteGrid, GridTool, safeOutOfBounds } from './grid';\r\nimport { Vec2, smallestDifferenceRadians } from './math';\r\n\r\nexport interface EdgeMarkedMapTile {\r\n    kind: 'air' | 'dirt' | 'edge',\r\n    normal: number,\r\n}\r\n\r\nexport const markEdges = (grid: Grid<boolean>): WriteGrid<EdgeMarkedMapTile> => {\r\n    const result = GridTool.map(grid, (x, y, val): EdgeMarkedMapTile => \r\n        ({ kind: val ? 'dirt' : 'air', normal: 0 }));\r\n\r\n    for (let x = 0; x < grid.width; x++) {\r\n        for (let y = 0; y < grid.height; y++) {\r\n            if (!grid.at(x, y)) continue;\r\n\r\n            const l = x > 0               && !grid.at(x-1, y);\r\n            const r = x < grid.width - 2  && !grid.at(x+1, y);\r\n            const u = y > 0               && !grid.at(x, y-1);\r\n            const d = y < grid.height - 2 && !grid.at(x, y+1);\r\n\r\n            if (!l && !r && !u && !d) continue;\r\n\r\n            const normal = r && d ? 45 :\r\n                d && l ?  135 :\r\n                l && u ? -135 :\r\n                u && r ?  -45 :\r\n                r ? 0 :\r\n                d ? 90 :\r\n                l ? 180 :\r\n                -90;\r\n\r\n            result.write(x, y, { kind: 'edge', normal });\r\n        }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\nexport enum WalkedStatus {\r\n    Unwalked,\r\n    Walked,\r\n    WalkedImportant,\r\n}\r\n\r\ninterface WalkCandidate {\r\n    dx: number,\r\n    dy: number,\r\n    normal: number,\r\n}\r\n\r\ninterface GridPoint {\r\n    x: number,\r\n    y: number,\r\n}\r\n\r\nexport interface FindContoursResult {\r\n    contours: Vec2[][],\r\n    walkMap: WriteGrid<WalkedStatus>,\r\n}\r\n\r\nexport const findContours = (grid: Grid<EdgeMarkedMapTile>, spaceInsurance: 0 | 1 | 2): FindContoursResult => {\r\n    const MAX_ITER = 100;\r\n    const walkMap = GridTool.map(new WriteGrid<WalkedStatus>(grid.width, grid.height), _ => WalkedStatus.Unwalked);\r\n    const contours: Vec2[][] = [];\r\n\r\n    let iter = 0;\r\n    let newContour: Vec2[] | null = null;\r\n\r\n    do {\r\n        newContour = findOneContour(walkMap, grid, spaceInsurance);\r\n        if (newContour !== null && newContour.length > 2) {\r\n            contours.push(newContour);\r\n        }\r\n    } while (newContour != null && iter++ < MAX_ITER);\r\n\r\n    return { contours, walkMap };\r\n}\r\n\r\n// @ts-ignore\r\nconst findFreshContour = (walkMap: Grid<WalkedStatus>, grid: Grid<EdgeMarkedMapTile>): GridPoint | null => {\r\n    for (let x = 0; x < grid.width; x++) {\r\n        for (let y = 0; y < grid.height; y++) {\r\n            if (grid.at(x, y).kind === 'edge' && walkMap.at(x, y) === WalkedStatus.Unwalked) {\r\n                return { x, y };\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\nconst bestCandidate = (prev: WalkCandidate, candidates: WalkCandidate[]): WalkCandidate => {\r\n    let minVal = 100;\r\n    let minI = 0;\r\n\r\n    for (let i = 0; i < candidates.length; ++i) {\r\n        const c = candidates[i];\r\n        const d = Math.abs(smallestDifferenceRadians(\r\n            c.normal * Math.PI / 180,\r\n            prev.normal * Math.PI / 180\r\n        ));\r\n\r\n        if (d < minVal) {\r\n            minVal = d;\r\n            minI = i;\r\n        }\r\n    }\r\n\r\n    return candidates[minI];\r\n};\r\n\r\nconst findOneContour = (walkMap: WriteGrid<WalkedStatus>, grid: Grid<EdgeMarkedMapTile>, spaceInsurance: 0 | 1 | 2): Vec2[] | null => {\r\n    const MAX_ITER = 5000;\r\n\r\n    const freshStart = findFreshContour(walkMap, grid);\r\n    if (freshStart === null) {\r\n        return null;\r\n    }\r\n\r\n    grid = safeOutOfBounds(grid, {kind: 'dirt', normal: 0} as EdgeMarkedMapTile);\r\n\r\n    const points: Vec2[] = [];\r\n    let x = freshStart.x;\r\n    let y = freshStart.y;\r\n\r\n    let iter = 0;\r\n    let lastCan: WalkCandidate = { dx: 0, dy: 0, normal: 0 };\r\n    let lastStatus = WalkedStatus.Walked;\r\n    let candidates: WalkCandidate[] = [];\r\n\r\n    do {\r\n        candidates = [];\r\n\r\n        for (let dx = -1; dx <= 1; dx++) {\r\n            for (let dy = -1; dy <= 1; dy++) {\r\n                if (dx === 0 && dy === 0) continue;\r\n                if (grid.at(x+dx, y+dy).kind === 'edge'\r\n                && walkMap.at(x+dx, y+dy) === WalkedStatus.Unwalked) {\r\n                    candidates.push({dx, dy, normal: grid.at(x+dx, y+dy).normal});\r\n                }\r\n            }\r\n        }\r\n\r\n        if (candidates.length > 0) {\r\n            const c = bestCandidate(lastCan, candidates);\r\n            x += c.dx;\r\n            y += c.dy;\r\n\r\n            let newStatus = WalkedStatus.Walked;\r\n            if (c.normal !== lastCan.normal) {\r\n                let important;\r\n                if (spaceInsurance === 0) {\r\n                    important = true;\r\n                } else if (spaceInsurance === 1) {\r\n                    important = c.dx != 0 && c.dy != 0 || lastStatus != WalkedStatus.WalkedImportant;\r\n                } else {\r\n                    important = lastStatus != WalkedStatus.WalkedImportant;\r\n                }\r\n\r\n                if (important) {\r\n                    newStatus = WalkedStatus.WalkedImportant;\r\n                }\r\n            }\r\n\r\n            if (newStatus === WalkedStatus.WalkedImportant) {\r\n                points.push({\r\n                    x: (x + 0.5)/grid.width - 0.5,\r\n                    y: (y + 0.5)/grid.height - 0.5,\r\n                });\r\n            }\r\n\r\n            walkMap.write(x, y, newStatus);\r\n            lastStatus = newStatus;\r\n            lastCan = c;\r\n        }\r\n    }\r\n    while (candidates.length > 0 && iter++ < MAX_ITER);\r\n\r\n    return points;\r\n};","export interface Vec2 {\r\n    x: number,\r\n    y: number,\r\n}\r\n\r\nexport const V2 = {\r\n    add: (a: Vec2, b: Vec2): void => {\r\n        a.x += b.x;\r\n        a.y += b.y;\r\n    },\r\n\r\n    plus: (a: Vec2, b: Vec2): Vec2 => ({\r\n        x: a.x + b.x,\r\n        y: a.y + b.y,\r\n    }),\r\n\r\n    minus: (a: Vec2, b: Vec2): Vec2 => ({\r\n        x: a.x - b.x,\r\n        y: a.y - b.y,\r\n    }),\r\n\r\n    length: (a: Vec2): number =>\r\n        Math.sqrt(a.x*a.x + a.y*a.y),\r\n    \r\n    scaled: (a: Vec2, s: number): Vec2 => ({\r\n        x: s * a.x,\r\n        y: s * a.y,\r\n    }),\r\n};\r\n\r\nexport const smallestDifferenceRadians = (a: number, b: number): number => {\r\n    a %= 2 * Math.PI;\r\n    b %= 2 * Math.PI;\r\n\r\n    if (Math.abs(a - b) > Math.PI) {\r\n        if (a > 0) a -= 2 * Math.PI;\r\n        else a += 2 * Math.PI;\r\n    }\r\n\r\n    return a - b;\r\n}","import { Vec2, V2 } from \"./math\";\r\n\r\ninterface Pt {\r\n    pt: Vec2,\r\n    controlA: Vec2,\r\n    controlB: Vec2,\r\n}\r\n\r\nexport const smoothCurve = (input: Vec2[], resolution: number, curviness: number): Vec2[] => {\r\n    const pts: Pt[] = [];\r\n\r\n    if (resolution < 1) resolution = 1;\r\n\r\n    for (let i = 0; i < input.length; ++i) {\r\n        const prev = input[i == 0 ? input.length-1 : i-1];\r\n        const curr = input[i];\r\n        const next = input[(i + 1) % input.length];\r\n\r\n        const lenA = V2.length(V2.minus(prev, curr));\r\n        const lenB = V2.length(V2.minus(curr, next));\r\n\r\n        const midA = V2.scaled(V2.plus(prev, curr), 0.5);\r\n        const midB = V2.scaled(V2.plus(curr, next), 0.5);\r\n        const midDiff = V2.scaled(V2.minus(midA, midB), curviness);\r\n\r\n        const diffA = V2.scaled(midDiff,  lenA / (lenA + lenB));\r\n        const diffB = V2.scaled(midDiff, -lenB / (lenA + lenB));\r\n\r\n        pts.push({\r\n            pt: curr,\r\n            controlA: V2.plus(curr, diffA),\r\n            controlB: V2.plus(curr, diffB),\r\n        });\r\n    }\r\n\r\n    const inc = 1 / resolution;\r\n\r\n    const result: Vec2[] = [];\r\n    for (let i = 0; i < pts.length; ++i) {\r\n        const curr = pts[i];\r\n        const next = pts[(i + 1) % pts.length];\r\n\r\n        for (let t = 0; t < 1; t += inc) {\r\n            let newVal: Vec2 = { x: 0, y: 0 };\r\n\r\n            V2.add(newVal, V2.scaled(curr.pt       , (1-t)*(1-t)*(1-t)));\r\n            V2.add(newVal, V2.scaled(curr.controlB , 3*(1-t)*(1-t)*t));\r\n            V2.add(newVal, V2.scaled(next.controlA , 3*(1-t)*t*t));\r\n            V2.add(newVal, V2.scaled(next.pt       , t*t*t));\r\n\r\n            result.push(newVal);\r\n        }\r\n    }\r\n\r\n    return result;\r\n};"],"sourceRoot":""}