!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.width=e,this.height=t,this.vals=new Array(e*t)}return e.prototype.write=function(e,t,r){this.vals[e+t*this.width]=r},e.prototype.at=function(e,t){return this.vals[e+t*this.width]},e.prototype.copyFrom=function(e){for(var t=0;t<this.width&&t<e.width;++t)for(var r=0;r<this.height&&r<e.height;++r)this.write(t,r,e.at(t,r))},e}();t.WriteGrid=n,t.safeOutOfBounds=function(e,t){return{width:e.width,height:e.height,at:function(r,n){return r<0||n<0||r>=e.width||n>=e.width?t:e.at(r,n)}}},t.GridTool={find:function(e,t){for(var r=0;r<e.width;++r)for(var n=0;n<e.height;++n)if(t(r,n,e.at(r,n)))return{x:r,y:n};return null},forEach:function(e,t){for(var r=0;r<e.width;++r)for(var n=0;n<e.height;++n)t(r,n,e.at(r,n))},map:function(e,t){for(var r=new n(e.width,e.height),a=0;a<e.width;++a)for(var i=0;i<e.height;++i)r.write(a,i,t(a,i,e.at(a,i)));return r}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.V2={add:function(e,t){e.x+=t.x,e.y+=t.y},plus:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},minus:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},length:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},scaled:function(e,t){return{x:t*e.x,y:t*e.y}}},t.RectTool={area:function(e){return(e.xmax-e.xmin)*(e.ymax-e.ymin)}},t.smallestDifferenceRadians=function(e,t){return e%=2*Math.PI,t%=2*Math.PI,Math.abs(e-t)>Math.PI&&(e>0?e-=2*Math.PI:e+=2*Math.PI),e-t},t.findBounds=function(e){var t={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};return e.forEach(function(e){e.x<t.xmin&&(t.xmin=e.x),e.y<t.ymin&&(t.ymin=e.y),e.x>t.xmax&&(t.xmax=e.x),e.y>t.ymax&&(t.ymax=e.y)}),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(0),i=r(1);t.markEdges=function(e){for(var t=a.GridTool.map(e,function(e,t,r){return{kind:r?"dirt":"air",normal:0}}),r=0;r<e.width;r++)for(var n=0;n<e.height;n++)if(e.at(r,n)){var i=r>0&&!e.at(r-1,n),o=r<e.width-2&&!e.at(r+1,n),l=n>0&&!e.at(r,n-1),u=n<e.height-2&&!e.at(r,n+1);if(i||o||l||u){var d=o&&u?45:u&&i?135:i&&l?-135:l&&o?-45:o?0:u?90:i?180:-90;t.write(r,n,{kind:"edge",normal:d})}}return t},function(e){e[e.Unwalked=0]="Unwalked",e[e.Walked=1]="Walked",e[e.WalkedImportant=2]="WalkedImportant"}(n=t.WalkedStatus||(t.WalkedStatus={})),t.findContours=function(e,t){var r=a.GridTool.map(new a.WriteGrid(e.width,e.height),function(e){return n.Unwalked}),i=[],o=0,u=null;do{null!==(u=l(r,e,t))&&u.length>2&&i.push(u)}while(null!=u&&o++<100);return{contours:i,walkMap:r}};var o=function(e,t){for(var r=100,n=0,a=0;a<t.length;++a){var o=t[a],l=Math.abs(i.smallestDifferenceRadians(o.normal*Math.PI/180,e.normal*Math.PI/180));l<r&&(r=l,n=a)}return t[n]},l=function(e,t,r){var i=function(e,t){for(var r=0;r<t.width;r++)for(var a=0;a<t.height;a++)if("edge"===t.at(r,a).kind&&e.at(r,a)===n.Unwalked)return{x:r,y:a};return null}(e,t);if(null===i)return null;t=a.safeOutOfBounds(t,{kind:"dirt",normal:0});var l=[],u=i.x,d=i.y,f=0,h={dx:0,dy:0,normal:0},c=n.Walked,s=[];do{s=[];for(var y=-1;y<=1;y++)for(var v=-1;v<=1;v++)0===y&&0===v||"edge"===t.at(u+y,d+v).kind&&e.at(u+y,d+v)===n.Unwalked&&s.push({dx:y,dy:v,normal:t.at(u+y,d+v).normal});if(s.length>0){var g=o(h,s);u+=g.dx,d+=g.dy;var x=n.Walked;if(g.normal!==h.normal){(0===r||(1===r&&0!=g.dx&&0!=g.dy||c!=n.WalkedImportant))&&(x=n.WalkedImportant)}x===n.WalkedImportant&&l.push({x:(u+.5)/t.width-.5,y:(d+.5)/t.height-.5}),e.write(u,d,x),c=x,h=g}}while(s.length>0&&f++<5e3);return l}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),a=r(10),i={"vector-caves":n.initPost,"page2-webgl":a.initPost};window.initPost=function(e){return i[e]()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),a=r(0),i=r(2),o=function(){var e=function(){var e=Math.floor(256*Math.random()).toString(16);return e.length<2&&(e="0"+e),e};return"#"+e()+e()+e()},l=[0,0,0,0,0,0,0,0,0,0].map(function(e){return o()});t.initPost=function(){var e,t,r=document.getElementById("first-canvas").getContext("2d"),u=document.getElementById("seed-slider"),d=document.getElementById("insurance-slider"),f=document.getElementById("curviness-slider"),h=document.getElementById("quality-slider"),c=document.getElementById("second-canvas").getContext("2d"),s=document.getElementById("third-canvas").getContext("2d"),y=document.getElementById("fourth-canvas").getContext("2d"),v=document.getElementById("fifth-canvas").getContext("2d"),g=document.getElementById("sixth-canvas").getContext("2d"),x=document.getElementById("seventh-canvas").getContext("2d"),p=document.getElementById("eighth-canvas").getContext("2d"),w=document.getElementById("ninth-canvas").getContext("2d"),m=function(){var e={seed:parseInt(u.value),edgePointDist:parseInt(d.value),curveBend:2*parseFloat(f.value)/100,curveQuality:parseFloat(h.value)},t=n.generateCaveVerbose(e),m=t.cave,M=t.details;a.GridTool.forEach(M.automatonResult,function(e,t,n){r.fillStyle=n?"#000":"#FFF",r.fillRect(4*e,4*t,4,4)}),a.GridTool.forEach(M.coloredGrid,function(e,t,r){var n;c.fillStyle=(n=r)<0?"#000":l[n%l.length],c.fillRect(4*e,4*t,4,4)}),a.GridTool.forEach(M.filledGrid,function(e,t,r){s.fillStyle=r?"#000":"#FFF",s.fillRect(4*e,4*t,4,4)}),a.GridTool.forEach(M.edgeMarkedGrid,function(e,t,r){y.fillStyle="edge"===r.kind?function(e){var t=Math.cos(e*Math.PI/180),r=Math.sin(e*Math.PI/180),n=Math.round(15*(.5*t+.5)),a=Math.round(15*(.5*r+.5));return"#"+n.toString(16)+a.toString(16)+"f"}(r.normal):"air"===r.kind?"#655":"#77f",y.fillRect(4*e,4*t,4,4)});var k=M.findContoursResult;a.GridTool.forEach(k.walkMap,function(e,t,r){v.fillStyle=r===i.WalkedStatus.WalkedImportant?"#fff":r===i.WalkedStatus.Walked?"#333":"#000",v.fillRect(4*e,4*t,4,4),g.fillStyle=r===i.WalkedStatus.WalkedImportant?"#333":"#000",g.fillRect(9*e,9*t,9,9)}),k.contours.forEach(function(e,t){g.strokeStyle=t===M.outerMostContourIndex?"#f00":"#933";for(var r=0;r<e.length;++r){var n=(r+1)%e.length,a={x:9*k.walkMap.width*e[r].x,y:9*k.walkMap.height*e[r].y},i={x:9*k.walkMap.width*e[n].x,y:9*k.walkMap.height*e[n].y};g.beginPath(),g.moveTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y),g.lineTo(9*k.walkMap.width/2+i.x,9*k.walkMap.height/2+i.y),g.stroke()}}),x.strokeStyle="#0f0",x.fillStyle="#000",x.fillRect(0,0,675,675),m.edges.forEach(function(e,t){x.strokeStyle=t===M.outerMostContourIndex?"#0f0":"#393";for(var r=0;r<e.length;++r){var n=(r+1)%e.length,a={x:9*k.walkMap.width*e[r].x,y:9*k.walkMap.height*e[r].y},i={x:9*k.walkMap.width*e[n].x,y:9*k.walkMap.height*e[n].y};x.beginPath(),x.moveTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y),x.lineTo(9*k.walkMap.width/2+i.x,9*k.walkMap.height/2+i.y),x.stroke()}});var E=m.edges[M.outerMostContourIndex][M.topLeftMostVertexIndex];x.strokeStyle="#0f0",x.beginPath(),x.moveTo(9*k.walkMap.width/2+9*k.walkMap.width*E.x,9*k.walkMap.height/2+9*k.walkMap.height*E.y),x.lineTo(-9*k.walkMap.width/2,-9*k.walkMap.height/2),x.stroke(),x.strokeStyle="#9f9",x.beginPath(),x.arc(9*k.walkMap.width/2+9*k.walkMap.width*E.x,9*k.walkMap.height/2+9*k.walkMap.height*E.y,5,0,2*Math.PI),x.stroke(),p.fillStyle="#000",p.fillRect(0,0,675,675),m.edges.forEach(function(e,t){p.fillStyle=t===M.outerMostContourIndex?"#0f0":"#393",p.beginPath();var r=9*k.walkMap.width*e[0].x,n=9*k.walkMap.height*e[0].y;p.moveTo(9*k.walkMap.width/2+r,9*k.walkMap.height/2+n);for(var a=1;a<e.length;++a){var i={x:9*k.walkMap.width*e[a].x,y:9*k.walkMap.height*e[a].y};p.lineTo(9*k.walkMap.width/2+i.x,9*k.walkMap.height/2+i.y)}p.fill()}),w.fillStyle="#000",w.fillRect(0,0,675,675),m.triangles.forEach(function(e,t){for(var r=0;r<e.length-2;r+=3){w.fillStyle=o(),w.beginPath();var n=m.edges[t][e[r]],a={x:8*k.walkMap.width*n.x,y:8*k.walkMap.height*n.y};w.moveTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y);n=m.edges[t][e[r+1]],a={x:8*k.walkMap.width*n.x,y:8*k.walkMap.height*n.y};w.lineTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y);n=m.edges[t][e[r+2]],a={x:8*k.walkMap.width*n.x,y:8*k.walkMap.height*n.y};w.lineTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y);n=m.edges[t][e[r]],a={x:8*k.walkMap.width*n.x,y:8*k.walkMap.height*n.y};w.lineTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y),w.fill()}})};e=["oninput","onchange"],t=m,[u,d,f,h].forEach(function(r){e.forEach(function(e){r[e]=t})}),m()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(6),i=r(2),o=r(8),l=r(1),u=r(9),d=function(e,t,r,n,a,i){if(t<0||r<0)return i;if(t>=e.width||r>=e.height)return i;var o=e.at(t,r);return o===a?i:o!==n?i:(e.write(t,r,a),i=d(e,t-1,r,n,a,++i),i=d(e,t+1,r,n,a,i),i=d(e,t,r-1,n,a,i),i=d(e,t,r+1,n,a,i))};t.generateCave=function(e){return t.generateCaveVerbose(e).cave},t.generateCaveVerbose=function(e){var t,r=a.runCellularAutomaton(75,75,e.seed,.48,5,4,40),f=n.GridTool.map(r,function(e,t,r){return r?-1:0}),h=function(e){for(var t=1,r=-1,a=0;;){var i=n.GridTool.find(e,function(e,t,r){return 0===r});if(null===i)return r;var o=d(e,i.x,i.y,0,t,0);o>a&&(a=o,r=t),t++}}(f),c=n.GridTool.map(f,function(e,t,r){return r!==h});t=c,n.GridTool.forEach(n.safeOutOfBounds(t,!0),function(e,r,n){n&&(!n||t.at(e-1,r)||t.at(e+1,r)||t.write(e+1,r,!0),!n||t.at(e,r-1)||t.at(e,r+1)||t.write(e,r+1,!0))});var s=i.markEdges(c),y=i.findContours(s,e.edgePointDist),v=y.contours.map(function(e,t){return{i:t,area:l.RectTool.area(l.findBounds(e))}}).sort(function(e,t){return t.area-e.area})[0].i,g=y.contours.map(function(t){return o.smoothCurve(t,e.curveQuality,e.curveBend)}),x=g[v].map(function(e,t){return{i:t,len:(e.x+.51)*(e.x+.51)+(e.y+.51)*(e.y+.51)}}).sort(function(e,t){return e.len-t.len})[0].i,p=g[v][x],w=g[v][0===x?g[v].length-1:x-1],m=Math.abs(p.y-w.y);g[v].splice(x,0,{x:-.51,y:-.51+m},{x:-.51,y:.51},{x:.51,y:.51},{x:.51,y:-.51},{x:-.51,y:-.51},{x:(p.x+w.x)/2,y:(p.y+w.y)/2});var M=g.map(u.triangulate);return g[v][x].y-=m,g[v][x+5].x=w.x,g[v][x+5].y=w.y,{cave:{edges:g,triangles:M},details:{automatonResult:r,coloredGrid:f,filledGrid:c,edgeMarkedGrid:s,findContoursResult:y,outerMostContourIndex:v,topLeftMostVertexIndex:x}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(7),a=r(0),i=function(e,t,r){for(var n=0,a=t-1;a<=t+1;++a)for(var i=r-1;i<=r+1;++i)a==t&&i==r||(a<1||i<1||a>=e.width-1||i>=e.height-1?n++:n+=e.at(a,i)?1:0);return n};t.runCellularAutomaton=function(e,t,r,o,l,u,d){for(var f=new a.WriteGrid(e,t),h=new a.WriteGrid(e,t),c=n.nextRandom01(r/101),s=0;s<e;++s)for(var y=0;y<t;++y){var v=0===s||0===y||s===e-1||y===t-1||c<o;f.write(s,y,v),h.write(s,y,v),c=n.nextRandom01(c)}for(var g=0;g<d;++g){for(s=1;s<e-1;++s)for(y=1;y<t-1;++y){var x=i(f,s,y);h.write(s,y,x>=(f.at(s,y)?u:l))}f.copyFrom(h)}return f}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=4294967296;t.nextRandom01=function(e){return(1664525*Math.floor(e*n)+1013904223)%n/n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.smoothCurve=function(e,t,r){var a=[];t<1&&(t=1);for(var i=0;i<e.length;++i){var o=e[0==i?e.length-1:i-1],l=e[i],u=e[(i+1)%e.length],d=n.V2.length(n.V2.minus(o,l)),f=n.V2.length(n.V2.minus(l,u)),h=n.V2.scaled(n.V2.plus(o,l),.5),c=n.V2.scaled(n.V2.plus(l,u),.5),s=n.V2.scaled(n.V2.minus(h,c),r),y=n.V2.scaled(s,d/(d+f)),v=n.V2.scaled(s,-f/(d+f));a.push({pt:l,controlA:n.V2.plus(l,y),controlB:n.V2.plus(l,v)})}var g=1/t,x=[];for(i=0;i<a.length;++i){l=a[i],u=a[(i+1)%a.length];for(var p=0;p<1-g/2;p+=g){var w={x:0,y:0};n.V2.add(w,n.V2.scaled(l.pt,(1-p)*(1-p)*(1-p))),n.V2.add(w,n.V2.scaled(l.controlB,3*(1-p)*(1-p)*p)),n.V2.add(w,n.V2.scaled(u.controlA,3*(1-p)*p*p)),n.V2.add(w,n.V2.scaled(u.pt,p*p*p)),x.push(w)}}return x}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.triangulate=function(e){var t=[],r=e.length;if(r<3)return t;var a=new Array(r);if(n(e)>0)for(var o=0;o<r;o++)a[o]=o;else for(o=0;o<r;o++)a[o]=r-1-o;var l=r,u=2*l;for(o=l-1;l>2;){if(u--<=0)return t;var d=o;l<=d&&(d=0),l<=(o=d+1)&&(o=0);var f=o+1;if(l<=f&&(f=0),i(e,d,o,f,l,a)){t.push(a[d]),t.push(a[o]),t.push(a[f]);for(var h=o,c=o+1;c<l;h++,c++)a[h]=a[c];u=2*--l}}return t};var n=function(e){for(var t=0,r=e.length-1,n=0;n<e.length;r=n++)t+=e[r].x*e[n].y-e[n].x*e[r].y;return t/2},a=function(e,t,r,n){var a=r.x-t.x,i=r.y-t.y,o=e.x-r.x,l=e.y-r.y,u=t.x-e.x,d=t.y-e.y,f=n.x-e.x,h=n.y-e.y,c=n.x-t.x,s=n.y-t.y,y=n.x-r.x,v=n.y-r.y;return a*s-i*c>=0&&o*v-l*y>=0&&u*h-d*f>=0},i=function(e,t,r,n,i,o){var l=e[o[t]],u=e[o[r]],d=e[o[n]];if((u.x-l.x)*(d.y-l.y)-(u.y-l.y)*(d.x-l.x)<1e-7)return!1;for(var f=0;f<i;f++)if(f!=t&&f!=r&&f!=n){var h=e[o[f]];if(a(l,u,d,h))return!1}return!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),a=r(5),i=function(e){var t=[];return e.forEach(function(e){return t=t.concat(e)}),t},o=function(e){return i(i(e.edges).map(function(e){return[e.x,e.y]}))},l=function(e){var t=0,r=[];return e.triangles.forEach(function(n,a){r=r.concat(n.map(function(e){return e+t})),t+=e.edges[a].length}),r},u=function(){function e(e,t,r){this.gl=e,this.shader=r,this.vao=e.createVertexArray(),e.bindVertexArray(this.vao),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(o(t)),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0);var n=l(t);this.indexBufferLen=n.length,this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),e.STATIC_DRAW)}return e.prototype.draw=function(){var e=this.gl;e.bindVertexArray(this.vao),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.useProgram(this.shader),e.drawElements(e.TRIANGLES,this.indexBufferLen,e.UNSIGNED_SHORT,0)},e.prototype.delete=function(){var e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindBuffer(e.ARRAY_BUFFER,null),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteVertexArray(this.vao)},e}();t.initPost=function(){var e=document.getElementById("first-canvas"),t=e.getContext("webgl2");t.viewport(0,0,e.width,e.height),t.cullFace(t.BACK),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),Promise.all([n.loadShader(t,"/shaders/purple.glsl"),n.loadShader(t,"/shaders/bufferCopy.glsl")]).then(function(e){var r=e[0],n=e[1];if("string"!=typeof r&&"string"!=typeof n){var i=a.generateCave({seed:Math.random(),curveBend:.75,curveQuality:10,edgePointDist:2});t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),new u(t,i,r).draw()}else console.log("Shader error: "+r+n)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.loadShader=function(e,t){return fetch(t).then(function(e){if(!e.ok)throw new Error("HTTP error, status = "+e.status);return e.text()}).then(function(t){return function(e,t){var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,"#version 300 es\n    #define VERTEX\n    #define v2f out\n    "+t+"\n"),e.compileShader(r);var n=e.getShaderInfoLog(r);if(null===n||n.length>0)return n;var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,"#version 300 es\n    #define FRAGMENT\n    #define v2f in\n    precision highp float;\n    "+t+"\n"),e.compileShader(a);var i=e.getShaderInfoLog(a);if(null===i||i.length>0)return i;var o=e.createProgram();return e.attachShader(o,r),e.attachShader(o,a),e.linkProgram(o),o}(e,t)})}}]);
//# sourceMappingURL=bundle.js.map