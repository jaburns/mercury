!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.width=e,this.height=t,this.vals=new Array(e*t)}return e.prototype.write=function(e,t,r){this.vals[e+t*this.width]=r},e.prototype.at=function(e,t){return this.vals[e+t*this.width]},e.prototype.copyFrom=function(e){for(var t=0;t<this.width&&t<e.width;++t)for(var r=0;r<this.height&&r<e.height;++r)this.write(t,r,e.at(t,r))},e}();t.WriteGrid=n,t.safeOutOfBounds=function(e,t){return{width:e.width,height:e.height,at:function(r,n){return r<0||n<0||r>=e.width||n>=e.width?t:e.at(r,n)}}},t.GridTool={find:function(e,t){for(var r=0;r<e.width;++r)for(var n=0;n<e.height;++n)if(t(r,n,e.at(r,n)))return{x:r,y:n};return null},forEach:function(e,t){for(var r=0;r<e.width;++r)for(var n=0;n<e.height;++n)t(r,n,e.at(r,n))},map:function(e,t){for(var r=new n(e.width,e.height),a=0;a<e.width;++a)for(var o=0;o<e.height;++o)r.write(a,o,t(a,o,e.at(a,o)));return r}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.V2={add:function(e,t){e.x+=t.x,e.y+=t.y},plus:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},minus:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},length:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},scaled:function(e,t){return{x:t*e.x,y:t*e.y}}},t.RectTool={area:function(e){return(e.xmax-e.xmin)*(e.ymax-e.ymin)}},t.smallestDifferenceRadians=function(e,t){return e%=2*Math.PI,t%=2*Math.PI,Math.abs(e-t)>Math.PI&&(e>0?e-=2*Math.PI:e+=2*Math.PI),e-t},t.findBounds=function(e){var t={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};return e.forEach(function(e){e.x<t.xmin&&(t.xmin=e.x),e.y<t.ymin&&(t.ymin=e.y),e.x>t.xmax&&(t.xmax=e.x),e.y>t.ymax&&(t.ymax=e.y)}),t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),a=r(9),o={"vector-caves":n.initPost,"page2-webgl":a.initPost};window.initPost=function(e){return o[e]()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(11),a=r(0),o=r(6),i=function(){var e=function(){var e=Math.floor(256*Math.random()).toString(16);return e.length<2&&(e="0"+e),e};return"#"+e()+e()+e()},l=[0,0,0,0,0,0,0,0,0,0].map(function(e){return i()});t.initPost=function(){var e,t,r=document.getElementById("first-canvas").getContext("2d"),u=document.getElementById("seed-slider"),d=document.getElementById("pop-slider"),f=document.getElementById("gen-slider"),h=document.getElementById("insurance-slider"),c=document.getElementById("curviness-slider"),s=document.getElementById("quality-slider"),y=document.getElementById("second-canvas").getContext("2d"),v=document.getElementById("third-canvas").getContext("2d"),g=document.getElementById("fourth-canvas").getContext("2d"),p=document.getElementById("fifth-canvas").getContext("2d"),x=document.getElementById("sixth-canvas").getContext("2d"),w=document.getElementById("seventh-canvas").getContext("2d"),m=document.getElementById("eighth-canvas").getContext("2d"),M=document.getElementById("ninth-canvas").getContext("2d"),k=function(){var e={seed:parseInt(u.value),edgePointDist:parseInt(h.value),curveBend:2*parseFloat(c.value)/100,curveQuality:parseFloat(s.value)},t=n.generateCaveVerbose(e),d=t.cave,f=t.details;a.GridTool.forEach(f.automatonResult,function(e,t,n){r.fillStyle=n?"#000":"#FFF",r.fillRect(4*e,4*t,4,4)}),a.GridTool.forEach(f.coloredGrid,function(e,t,r){var n;y.fillStyle=(n=r)<0?"#000":l[n%l.length],y.fillRect(4*e,4*t,4,4)}),a.GridTool.forEach(f.filledGrid,function(e,t,r){v.fillStyle=r?"#000":"#FFF",v.fillRect(4*e,4*t,4,4)}),a.GridTool.forEach(f.edgeMarkedGrid,function(e,t,r){g.fillStyle="edge"===r.kind?function(e){var t=Math.cos(e*Math.PI/180),r=Math.sin(e*Math.PI/180),n=Math.round(15*(.5*t+.5)),a=Math.round(15*(.5*r+.5));return"#"+n.toString(16)+a.toString(16)+"f"}(r.normal):"air"===r.kind?"#655":"#77f",g.fillRect(4*e,4*t,4,4)});var k=f.findContoursResult;a.GridTool.forEach(k.walkMap,function(e,t,r){p.fillStyle=r===o.WalkedStatus.WalkedImportant?"#fff":r===o.WalkedStatus.Walked?"#333":"#000",p.fillRect(4*e,4*t,4,4),x.fillStyle=r===o.WalkedStatus.WalkedImportant?"#333":"#000",x.fillRect(9*e,9*t,9,9)}),k.contours.forEach(function(e,t){x.strokeStyle=t===f.outerMostContourIndex?"#f00":"#933";for(var r=0;r<e.length;++r){var n=(r+1)%e.length,a={x:9*k.walkMap.width*e[r].x,y:9*k.walkMap.height*e[r].y},o={x:9*k.walkMap.width*e[n].x,y:9*k.walkMap.height*e[n].y};x.beginPath(),x.moveTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y),x.lineTo(9*k.walkMap.width/2+o.x,9*k.walkMap.height/2+o.y),x.stroke()}}),w.strokeStyle="#0f0",w.fillStyle="#000",w.fillRect(0,0,675,675),d.edges.forEach(function(e,t){w.strokeStyle=t===f.outerMostContourIndex?"#0f0":"#393";for(var r=0;r<e.length;++r){var n=(r+1)%e.length,a={x:9*k.walkMap.width*e[r].x,y:9*k.walkMap.height*e[r].y},o={x:9*k.walkMap.width*e[n].x,y:9*k.walkMap.height*e[n].y};w.beginPath(),w.moveTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y),w.lineTo(9*k.walkMap.width/2+o.x,9*k.walkMap.height/2+o.y),w.stroke()}});var E=d.edges[f.outerMostContourIndex][f.topLeftMostVertexIndex];w.strokeStyle="#0f0",w.beginPath(),w.moveTo(9*k.walkMap.width/2+9*k.walkMap.width*E.x,9*k.walkMap.height/2+9*k.walkMap.height*E.y),w.lineTo(-9*k.walkMap.width/2,-9*k.walkMap.height/2),w.stroke(),w.strokeStyle="#9f9",w.beginPath(),w.arc(9*k.walkMap.width/2+9*k.walkMap.width*E.x,9*k.walkMap.height/2+9*k.walkMap.height*E.y,5,0,2*Math.PI),w.stroke(),m.fillStyle="#000",m.fillRect(0,0,675,675),d.edges.forEach(function(e,t){m.fillStyle=t===f.outerMostContourIndex?"#0f0":"#393",m.beginPath();var r=9*k.walkMap.width*e[0].x,n=9*k.walkMap.height*e[0].y;m.moveTo(9*k.walkMap.width/2+r,9*k.walkMap.height/2+n);for(var a=1;a<e.length;++a){var o={x:9*k.walkMap.width*e[a].x,y:9*k.walkMap.height*e[a].y};m.lineTo(9*k.walkMap.width/2+o.x,9*k.walkMap.height/2+o.y)}m.fill()}),M.fillStyle="#000",M.fillRect(0,0,675,675),d.triangles.forEach(function(e,t){for(var r=0;r<e.length-2;r+=3){M.fillStyle=i(),M.beginPath();var n=d.edges[t][e[r]],a={x:8*k.walkMap.width*n.x,y:8*k.walkMap.height*n.y};M.moveTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y);n=d.edges[t][e[r+1]],a={x:8*k.walkMap.width*n.x,y:8*k.walkMap.height*n.y};M.lineTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y);n=d.edges[t][e[r+2]],a={x:8*k.walkMap.width*n.x,y:8*k.walkMap.height*n.y};M.lineTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y);n=d.edges[t][e[r]],a={x:8*k.walkMap.width*n.x,y:8*k.walkMap.height*n.y};M.lineTo(9*k.walkMap.width/2+a.x,9*k.walkMap.height/2+a.y),M.fill()}})};e=["oninput","onchange"],t=k,[d,f,u,h,c,s].forEach(function(r){e.forEach(function(e){r[e]=t})}),k()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),a=r(0),o=function(e,t,r){for(var n=0,a=t-1;a<=t+1;++a)for(var o=r-1;o<=r+1;++o)a==t&&o==r||(a<1||o<1||a>=e.width-1||o>=e.height-1?n++:n+=e.at(a,o)?1:0);return n};t.runCellularAutomaton=function(e,t,r,i,l,u,d){for(var f=new a.WriteGrid(e,t),h=new a.WriteGrid(e,t),c=n.nextRandom01(r/101),s=0;s<e;++s)for(var y=0;y<t;++y){var v=0===s||0===y||s===e-1||y===t-1||c<i;f.write(s,y,v),h.write(s,y,v),c=n.nextRandom01(c)}for(var g=0;g<d;++g){for(s=1;s<e-1;++s)for(y=1;y<t-1;++y){var p=o(f,s,y);h.write(s,y,p>=(f.at(s,y)?u:l))}f.copyFrom(h)}return f}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=4294967296;t.nextRandom01=function(e){return(1664525*Math.floor(e*n)+1013904223)%n/n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,a=r(0),o=r(1);t.markEdges=function(e){for(var t=a.GridTool.map(e,function(e,t,r){return{kind:r?"dirt":"air",normal:0}}),r=0;r<e.width;r++)for(var n=0;n<e.height;n++)if(e.at(r,n)){var o=r>0&&!e.at(r-1,n),i=r<e.width-2&&!e.at(r+1,n),l=n>0&&!e.at(r,n-1),u=n<e.height-2&&!e.at(r,n+1);if(o||i||l||u){var d=i&&u?45:u&&o?135:o&&l?-135:l&&i?-45:i?0:u?90:o?180:-90;t.write(r,n,{kind:"edge",normal:d})}}return t},function(e){e[e.Unwalked=0]="Unwalked",e[e.Walked=1]="Walked",e[e.WalkedImportant=2]="WalkedImportant"}(n=t.WalkedStatus||(t.WalkedStatus={})),t.findContours=function(e,t){var r=a.GridTool.map(new a.WriteGrid(e.width,e.height),function(e){return n.Unwalked}),o=[],i=0,u=null;do{null!==(u=l(r,e,t))&&u.length>2&&o.push(u)}while(null!=u&&i++<100);return{contours:o,walkMap:r}};var i=function(e,t){for(var r=100,n=0,a=0;a<t.length;++a){var i=t[a],l=Math.abs(o.smallestDifferenceRadians(i.normal*Math.PI/180,e.normal*Math.PI/180));l<r&&(r=l,n=a)}return t[n]},l=function(e,t,r){var o=function(e,t){for(var r=0;r<t.width;r++)for(var a=0;a<t.height;a++)if("edge"===t.at(r,a).kind&&e.at(r,a)===n.Unwalked)return{x:r,y:a};return null}(e,t);if(null===o)return null;t=a.safeOutOfBounds(t,{kind:"dirt",normal:0});var l=[],u=o.x,d=o.y,f=0,h={dx:0,dy:0,normal:0},c=n.Walked,s=[];do{s=[];for(var y=-1;y<=1;y++)for(var v=-1;v<=1;v++)0===y&&0===v||"edge"===t.at(u+y,d+v).kind&&e.at(u+y,d+v)===n.Unwalked&&s.push({dx:y,dy:v,normal:t.at(u+y,d+v).normal});if(s.length>0){var g=i(h,s);u+=g.dx,d+=g.dy;var p=n.Walked;if(g.normal!==h.normal){(0===r||(1===r&&0!=g.dx&&0!=g.dy||c!=n.WalkedImportant))&&(p=n.WalkedImportant)}p===n.WalkedImportant&&l.push({x:(u+.5)/t.width-.5,y:(d+.5)/t.height-.5}),e.write(u,d,p),c=p,h=g}}while(s.length>0&&f++<5e3);return l}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.smoothCurve=function(e,t,r){var a=[];t<1&&(t=1);for(var o=0;o<e.length;++o){var i=e[0==o?e.length-1:o-1],l=e[o],u=e[(o+1)%e.length],d=n.V2.length(n.V2.minus(i,l)),f=n.V2.length(n.V2.minus(l,u)),h=n.V2.scaled(n.V2.plus(i,l),.5),c=n.V2.scaled(n.V2.plus(l,u),.5),s=n.V2.scaled(n.V2.minus(h,c),r),y=n.V2.scaled(s,d/(d+f)),v=n.V2.scaled(s,-f/(d+f));a.push({pt:l,controlA:n.V2.plus(l,y),controlB:n.V2.plus(l,v)})}var g=1/t,p=[];for(o=0;o<a.length;++o){l=a[o],u=a[(o+1)%a.length];for(var x=0;x<1-g/2;x+=g){var w={x:0,y:0};n.V2.add(w,n.V2.scaled(l.pt,(1-x)*(1-x)*(1-x))),n.V2.add(w,n.V2.scaled(l.controlB,3*(1-x)*(1-x)*x)),n.V2.add(w,n.V2.scaled(u.controlA,3*(1-x)*x*x)),n.V2.add(w,n.V2.scaled(u.pt,x*x*x)),p.push(w)}}return p}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.triangulate=function(e){var t=[],r=e.length;if(r<3)return t;var a=new Array(r);if(n(e)>0)for(var i=0;i<r;i++)a[i]=i;else for(i=0;i<r;i++)a[i]=r-1-i;var l=r,u=2*l;for(i=l-1;l>2;){if(u--<=0)return t;var d=i;l<=d&&(d=0),l<=(i=d+1)&&(i=0);var f=i+1;if(l<=f&&(f=0),o(e,d,i,f,l,a)){t.push(a[d]),t.push(a[i]),t.push(a[f]);for(var h=i,c=i+1;c<l;h++,c++)a[h]=a[c];u=2*--l}}return t};var n=function(e){for(var t=0,r=e.length-1,n=0;n<e.length;r=n++)t+=e[r].x*e[n].y-e[n].x*e[r].y;return t/2},a=function(e,t,r,n){var a=r.x-t.x,o=r.y-t.y,i=e.x-r.x,l=e.y-r.y,u=t.x-e.x,d=t.y-e.y,f=n.x-e.x,h=n.y-e.y,c=n.x-t.x,s=n.y-t.y,y=n.x-r.x,v=n.y-r.y;return a*s-o*c>=0&&i*v-l*y>=0&&u*h-d*f>=0},o=function(e,t,r,n,o,i){var l=e[i[t]],u=e[i[r]],d=e[i[n]];if((u.x-l.x)*(d.y-l.y)-(u.y-l.y)*(d.x-l.x)<1e-7)return!1;for(var f=0;f<o;f++)if(f!=t&&f!=r&&f!=n){var h=e[i[f]];if(a(l,u,d,h))return!1}return!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(10);t.initPost=function(){var e=document.getElementById("first-canvas"),t=e.getContext("webgl2");t.viewport(0,0,e.width,e.height),t.cullFace(t.BACK),Promise.all([n.loadShader(t,"/shaders/purple.glsl"),n.loadShader(t,"/shaders/bufferCopy.glsl")]).then(function(r){var n=r[0],a=r[1];if("string"!=typeof n&&"string"!=typeof a){var o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o);var i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGB,e.width,e.height,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.clearColor(0,1,0,1),t.clear(t.COLOR_BUFFER_BIT);var l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-.95,.95,0,-.95,-.95,0,.95,-.95,0,.9,0,0,.9,.9,0,0,.9,0]),t.STATIC_DRAW),t.useProgram(n);var u=t.getAttribLocation(n,"c");t.vertexAttribPointer(u,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(u),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,null);l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,1,0,-1,-1,0,1,-1,0,1,-1,0,1,1,0,-1,1,0]),t.STATIC_DRAW),t.useProgram(a);u=t.getAttribLocation(a,"c");t.vertexAttribPointer(u,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(u),t.drawArrays(t.TRIANGLES,0,6)}else console.log("Shader error: "+n+a)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.loadShader=function(e,t){return fetch(t).then(function(e){if(!e.ok)throw new Error("HTTP error, status = "+e.status);return e.text()}).then(function(t){return function(e,t){var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,"#version 300 es\n    #define VERTEX\n    #define v2f out\n    "+t+"\n"),e.compileShader(r);var n=e.getShaderInfoLog(r);if(null===n||n.length>0)return n;var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,"#version 300 es\n    #define FRAGMENT\n    #define v2f in\n    precision highp float;\n    "+t+"\n"),e.compileShader(a);var o=e.getShaderInfoLog(a);if(null===o||o.length>0)return o;var i=e.createProgram();return e.attachShader(i,r),e.attachShader(i,a),e.linkProgram(i),i}(e,t)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(4),o=r(6),i=r(7),l=r(1),u=r(8),d=function(e,t,r,n,a,o){if(t<0||r<0)return o;if(t>=e.width||r>=e.height)return o;var i=e.at(t,r);return i===a?o:i!==n?o:(e.write(t,r,a),o=d(e,t-1,r,n,a,++o),o=d(e,t+1,r,n,a,o),o=d(e,t,r-1,n,a,o),o=d(e,t,r+1,n,a,o))};t.generateCave=function(e){return t.generateCaveVerbose(e).cave},t.generateCaveVerbose=function(e){var t,r=a.runCellularAutomaton(75,75,e.seed,.48,5,4,40),f=n.GridTool.map(r,function(e,t,r){return r?-1:0}),h=function(e){for(var t=1,r=-1,a=0;;){var o=n.GridTool.find(e,function(e,t,r){return 0===r});if(null===o)return r;var i=d(e,o.x,o.y,0,t,0);i>a&&(a=i,r=t),t++}}(f),c=n.GridTool.map(f,function(e,t,r){return r!==h});t=c,n.GridTool.forEach(n.safeOutOfBounds(t,!0),function(e,r,n){n&&(!n||t.at(e-1,r)||t.at(e+1,r)||t.write(e+1,r,!0),!n||t.at(e,r-1)||t.at(e,r+1)||t.write(e,r+1,!0))});var s=o.markEdges(c),y=o.findContours(s,e.edgePointDist),v=y.contours.map(function(e,t){return{i:t,area:l.RectTool.area(l.findBounds(e))}}).sort(function(e,t){return t.area-e.area})[0].i,g=y.contours.map(function(t){return i.smoothCurve(t,e.curveQuality,e.curveBend)}),p=g[v].map(function(e,t){return{i:t,len:(e.x+.51)*(e.x+.51)+(e.y+.51)*(e.y+.51)}}).sort(function(e,t){return e.len-t.len})[0].i,x=g[v][p],w=g[v][0===p?g[v].length-1:p-1],m=Math.abs(x.y-w.y);g[v].splice(p,0,{x:-.51,y:-.51+m},{x:-.51,y:.51},{x:.51,y:.51},{x:.51,y:-.51},{x:-.51,y:-.51},{x:(x.x+w.x)/2,y:(x.y+w.y)/2});var M=g.map(u.triangulate);return g[v][p].y-=m,g[v][p+5].x=w.x,g[v][p+5].y=w.y,{cave:{edges:g,triangles:M},details:{automatonResult:r,coloredGrid:f,filledGrid:c,edgeMarkedGrid:s,findContoursResult:y,outerMostContourIndex:v,topLeftMostVertexIndex:p}}}}]);
//# sourceMappingURL=bundle.js.map